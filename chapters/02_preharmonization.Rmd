
# Pre-harmonization decision process

## Justification

Following the completion of the download process described in the
previous chapter, the pipeline contains raw data for a variety of
potential parameters of interest. Before we begin to harmonize each
individual parameter we run through a series of “pre-harmonization”
steps, which ensure that each parameter will enter its individual
harmonization routine with a dataset that has been formatted identically
to each other parameter in the pipeline.

## Initial dataset

At the start of the pre-harmonization process the WQP dataset contains
the parameters chlorophyll, doc, secchi, tss and 14.2 million rows.

![](/Users/mbrousil/Documents/aquasat_v2/chapters/02_preharmonization_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

<br>

## Missing results

Next records that have missing data are dropped from the dataset.
Several criteria are used when checking for missing data. If any of the
below criteria are met the row is flagged as missing:

1.  Both the result column and detection limit column had `NA` data
2.  Result, result unit, activity comment, laboratory comment, and
    result comment columns are all `NA`
3.  The result comment column contains any user-provided text indicating
    a missing value, currently including: `analysis lost`,
    `not analyzed`, `not recorded`, `not collected`, or
    `no measurement taken`

91.33 thousand rows are dropped, resulting in a final count of 13.64
million.

![](/Users/mbrousil/Documents/aquasat_v2/chapters/02_preharmonization_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

<br>

## Filter status

We next filter the `ResultStatusIdentifier` column to include only the
following statuses:

- `"Accepted"`
- `"Final"`
- `"Historical"`
- `"Validated"`
- `"Preliminary"`
- `NA`

These statuses generally indicate a reliable result having been reached,
however we also include `NA` in an effort to be conservative. More
specifically, when making decisions for this and other columns we
occasionally retain `NA` values if removing the records would otherwise
drop 10% or more of the available data. 12.01 thousand rows are dropped
from the dataset leaving it with 13.62 million remaining.

![](/Users/mbrousil/Documents/aquasat_v2/chapters/02_preharmonization_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

<br>

## Filter media

Next the `ActivityMediaSubdivisionName` is filtered to only include only
the following media types:

- `"Surface Water"`
- `"Water"`
- `"Estuary"`
- `NA`

0 thousand rows are dropped and 13.62 million remain.

![](/Users/mbrousil/Documents/aquasat_v2/chapters/02_preharmonization_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

<br>

## Location type

The final step in pre-harmonization is filtering out any
`ResolvedMonitoringLocationTypeName` that is not `"Estuary"`,
`"Lake, Reservoir, Impoundment"`, or `"Stream"`.

After dropping rows the pre-harmonization dataset is complete with
million.

![](/Users/mbrousil/Documents/aquasat_v2/chapters/02_preharmonization_files/figure-gfm/unnamed-chunk-12-1.png)<!-- -->
