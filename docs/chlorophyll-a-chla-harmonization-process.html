<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Chlorophyll a (chla) harmonization process | _main.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Chlorophyll a (chla) harmonization process | _main.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Chlorophyll a (chla) harmonization process | _main.knit" />
  
  
  

<meta name="author" content="ROSSyndicate" />


<meta name="date" content="2024-05-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tiering-flagging-and-quality-control-philosophy.html"/>
<link rel="next" href="doc-harmonization-process.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> AquaMatch data harmonization process</a></li>
<li class="chapter" data-level="2" data-path="technical-details.html"><a href="technical-details.html"><i class="fa fa-check"></i><b>2</b> Technical details</a></li>
<li class="chapter" data-level="3" data-path="download-process.html"><a href="download-process.html"><i class="fa fa-check"></i><b>3</b> Download process</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="download-process.html"><a href="download-process.html#catalogue-existing-data"><i class="fa fa-check"></i><b>3.0.1</b> Catalogue existing data</a></li>
<li class="chapter" data-level="3.0.2" data-path="download-process.html"><a href="download-process.html#maps-of-data-spread"><i class="fa fa-check"></i><b>3.0.2</b> Maps of data spread</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html"><i class="fa fa-check"></i><b>4</b> Tiering, flagging, and quality control philosophy</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#handling-na-values"><i class="fa fa-check"></i><b>4.1</b> Handling <code>NA</code> values</a></li>
<li class="chapter" data-level="4.2" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#heterogenous-data"><i class="fa fa-check"></i><b>4.2</b> Heterogenous data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#method-tiering"><i class="fa fa-check"></i><b>4.2.1</b> Method tiering</a></li>
<li class="chapter" data-level="4.2.2" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#field-flags"><i class="fa fa-check"></i><b>4.2.2</b> Field flags</a></li>
<li class="chapter" data-level="4.2.3" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#depth-flags"><i class="fa fa-check"></i><b>4.2.3</b> Depth flags</a></li>
<li class="chapter" data-level="4.2.4" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#miscellaneous-flags"><i class="fa fa-check"></i><b>4.2.4</b> Miscellaneous flags</a></li>
<li class="chapter" data-level="4.2.5" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#time-and-date-handling"><i class="fa fa-check"></i><b>4.2.5</b> Time and date handling</a></li>
<li class="chapter" data-level="4.2.6" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#general-notes"><i class="fa fa-check"></i><b>4.2.6</b> General notes</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="tiering-flagging-and-quality-control-philosophy.html"><a href="tiering-flagging-and-quality-control-philosophy.html#simultaneous-records"><i class="fa fa-check"></i><b>4.3</b> Simultaneous records</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html"><i class="fa fa-check"></i><b>5</b> Chlorophyll <em>a</em> (chla) harmonization process</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#pre-harmonization-of-the-raw-chlorophyll-wqp-dataset"><i class="fa fa-check"></i><b>5.1</b> Pre-harmonization of the raw chlorophyll WQP dataset</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#missing-results"><i class="fa fa-check"></i><b>5.1.1</b> Missing results</a></li>
<li class="chapter" data-level="5.1.2" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#filter-status"><i class="fa fa-check"></i><b>5.1.2</b> Filter status</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#harmonization-ready-chlorophyll-dataset"><i class="fa fa-check"></i><b>5.2</b> Harmonization-ready chlorophyll dataset</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#filter-for-water-media"><i class="fa fa-check"></i><b>5.2.1</b> Filter for water media</a></li>
<li class="chapter" data-level="5.2.2" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#document-and-remove-fails"><i class="fa fa-check"></i><b>5.2.2</b> Document and remove fails</a></li>
<li class="chapter" data-level="5.2.3" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#clean-mdls"><i class="fa fa-check"></i><b>5.2.3</b> Clean MDLs</a></li>
<li class="chapter" data-level="5.2.4" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#clean-approximate-values"><i class="fa fa-check"></i><b>5.2.4</b> Clean approximate values</a></li>
<li class="chapter" data-level="5.2.5" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#clean-values-with-greater-than-data"><i class="fa fa-check"></i><b>5.2.5</b> Clean values with “greater than” data</a></li>
<li class="chapter" data-level="5.2.6" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#drop-unresolved-na-measurements"><i class="fa fa-check"></i><b>5.2.6</b> Drop unresolved NA measurements</a></li>
<li class="chapter" data-level="5.2.7" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#harmonize-record-units"><i class="fa fa-check"></i><b>5.2.7</b> Harmonize record units</a></li>
<li class="chapter" data-level="5.2.8" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#clean-depth-data"><i class="fa fa-check"></i><b>5.2.8</b> Clean depth data</a></li>
<li class="chapter" data-level="5.2.9" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#filter-and-tier-methods"><i class="fa fa-check"></i><b>5.2.9</b> Filter and tier methods</a></li>
<li class="chapter" data-level="5.2.10" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#flag-based-on-field-methods"><i class="fa fa-check"></i><b>5.2.10</b> Flag based on field methods</a></li>
<li class="chapter" data-level="5.2.11" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#miscellaneous-flag"><i class="fa fa-check"></i><b>5.2.11</b> Miscellaneous flag</a></li>
<li class="chapter" data-level="5.2.12" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#remove-unrealistic-values"><i class="fa fa-check"></i><b>5.2.12</b> Remove unrealistic values</a></li>
<li class="chapter" data-level="5.2.13" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#aggregate-simultaneous-records"><i class="fa fa-check"></i><b>5.2.13</b> Aggregate simultaneous records</a></li>
<li class="chapter" data-level="5.2.14" data-path="chlorophyll-a-chla-harmonization-process.html"><a href="chlorophyll-a-chla-harmonization-process.html#harmonized-chlorophyll-a"><i class="fa fa-check"></i><b>5.2.14</b> Harmonized chlorophyll a</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html"><i class="fa fa-check"></i><b>6</b> DOC harmonization process</a>
<ul>
<li class="chapter" data-level="6.1" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#pre-harmonization-of-the-raw-doc-wqp-dataset"><i class="fa fa-check"></i><b>6.1</b> Pre-harmonization of the raw doc WQP dataset</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#missing-results-1"><i class="fa fa-check"></i><b>6.1.1</b> Missing results</a></li>
<li class="chapter" data-level="6.1.2" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#filter-status-1"><i class="fa fa-check"></i><b>6.1.2</b> Filter status</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#harmonization-ready-doc-dataset"><i class="fa fa-check"></i><b>6.2</b> Harmonization-ready DOC dataset</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#filter-media-and-fractions"><i class="fa fa-check"></i><b>6.2.1</b> Filter media and fractions</a></li>
<li class="chapter" data-level="6.2.2" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#document-and-remove-fails-1"><i class="fa fa-check"></i><b>6.2.2</b> Document and remove fails</a></li>
<li class="chapter" data-level="6.2.3" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#clean-mdls-1"><i class="fa fa-check"></i><b>6.2.3</b> Clean MDLs</a></li>
<li class="chapter" data-level="6.2.4" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#clean-approximate-values-1"><i class="fa fa-check"></i><b>6.2.4</b> Clean approximate values</a></li>
<li class="chapter" data-level="6.2.5" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#clean-values-with-greater-than-data-1"><i class="fa fa-check"></i><b>6.2.5</b> Clean values with “greater than” data</a></li>
<li class="chapter" data-level="6.2.6" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#drop-unresolved-na-measurements-1"><i class="fa fa-check"></i><b>6.2.6</b> Drop unresolved NA measurements</a></li>
<li class="chapter" data-level="6.2.7" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#harmonize-record-units-1"><i class="fa fa-check"></i><b>6.2.7</b> Harmonize record units</a></li>
<li class="chapter" data-level="6.2.8" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#clean-depth-data-1"><i class="fa fa-check"></i><b>6.2.8</b> Clean depth data</a></li>
<li class="chapter" data-level="6.2.9" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#filter-and-tier-analytical-methods"><i class="fa fa-check"></i><b>6.2.9</b> Filter and tier analytical methods</a></li>
<li class="chapter" data-level="6.2.10" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#flag-based-on-field-methods-1"><i class="fa fa-check"></i><b>6.2.10</b> Flag based on field methods</a></li>
<li class="chapter" data-level="6.2.11" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#aggregate-simultaneous-records-1"><i class="fa fa-check"></i><b>6.2.11</b> Aggregate simultaneous records</a></li>
<li class="chapter" data-level="6.2.12" data-path="doc-harmonization-process.html"><a href="doc-harmonization-process.html#harmonized-doc"><i class="fa fa-check"></i><b>6.2.12</b> Harmonized DOC</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>7</b> Notes</a></li>
<li class="chapter" data-level="8" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chlorophyll-a-chla-harmonization-process" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Chlorophyll <em>a</em> (chla) harmonization process<a href="chlorophyll-a-chla-harmonization-process.html#chlorophyll-a-chla-harmonization-process" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Following the completion of the {dataRetrieval} download process
described previously, the pipeline contains raw WQP data for each
parameter of interest. Before we harmonize each parameter we run through
a series of universal “pre-harmonization” steps, which ensure that the
datasets are appropriately formatted when entering their harmonization
routines.</p>
<p>The text below first walks through the pre-harmonization steps for the
raw chlorophyll <em>a</em> dataset and then delves into the specifics of the
harmonization process.</p>
<div id="pre-harmonization-of-the-raw-chlorophyll-wqp-dataset" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Pre-harmonization of the raw chlorophyll WQP dataset<a href="chlorophyll-a-chla-harmonization-process.html#pre-harmonization-of-the-raw-chlorophyll-wqp-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At the start of the pre-harmonization process the raw chlorophyll WQP
dataset contains 4.61 million rows.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-4-1.png" /><!-- --></p>
<p><br></p>
<div id="missing-results" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Missing results<a href="chlorophyll-a-chla-harmonization-process.html#missing-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, records that have missing data are dropped from the dataset.
Several criteria are used when checking for missing data. If any of the
below criteria are met the row is flagged as missing:</p>
<ol style="list-style-type: decimal">
<li>Both the result column and detection limit column had <code>NA</code> data</li>
<li>Result, result unit, activity comment, laboratory comment, and
result comment columns are all <code>NA</code></li>
<li>The result comment column contains any user-provided text indicating
a missing value, currently including: <code>analysis lost</code>,
<code>not analyzed</code>, <code>not recorded</code>, <code>not collected</code>, or
<code>no measurement taken</code></li>
</ol>
<p>50.07 thousand rows are dropped, resulting in a final count of 4.56
million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-6-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="filter-status" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Filter status<a href="chlorophyll-a-chla-harmonization-process.html#filter-status" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final step in pre-harmonization is to filter the
<code>ResultStatusIdentifier</code> column to include only the following statuses:</p>
<ul>
<li><code>"Accepted"</code></li>
<li><code>"Final"</code></li>
<li><code>"Historical"</code></li>
<li><code>"Validated"</code></li>
<li><code>"Preliminary"</code></li>
<li><code>NA</code></li>
</ul>
<p>These statuses generally indicate a reliable result having been reached,
however we also include <code>NA</code> in an effort to be conservative. More
specifically, when making decisions for this and other columns we
occasionally retain <code>NA</code> values if removing the records would otherwise
drop 10% or more of the available data.</p>
<p>This step removes 77.03 thousand rows of data, leaving it with 4.48
million rows remaining.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-8-1.png" /><!-- --></p>
<p><br></p>
</div>
</div>
<div id="harmonization-ready-chlorophyll-dataset" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Harmonization-ready chlorophyll dataset<a href="chlorophyll-a-chla-harmonization-process.html#harmonization-ready-chlorophyll-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once ready for harmonization, the chlorophyll <em>a</em>-only WQP dataset
contains the following user-defined <code>characteristicNames</code>: Chlorophyll
a, Chlorophyll a (probe relative fluorescence), Chlorophyll a, corrected
for pheophytin, Chlorophyll a (probe), Chlorophyll a, free of
pheophytin, Chlorophyll a, uncorrected for pheophytin, Chlorophyll a -
Phytoplankton (suspended).</p>
<p>These names are chosen in order to select for only those measurements
that pertain to chlorophyll <em>a</em>.</p>
<p><br></p>
<div id="filter-for-water-media" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Filter for water media<a href="chlorophyll-a-chla-harmonization-process.html#filter-for-water-media" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We next ensure that the media type for all chlorophyll data is
<code>"Surface Water"</code>, <code>"Water"</code>, <code>"Estuary"</code>, or <code>NA</code>. 2880 rows are
removed. The final row count after this is 4.48 million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-10-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="document-and-remove-fails" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Document and remove fails<a href="chlorophyll-a-chla-harmonization-process.html#document-and-remove-fails" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this step we filter out records based on indications that they have
failed data quality assurance or quality control for some reason given
by the data provider (these instances are referred to here as
“failures”).</p>
<p>After reviewing the contents of the <code>ActivityCommentText</code>,
<code>ResultLaboratoryCommentText</code>, <code>ResultCommentText</code>, and
<code>ResultMeasureValue_original</code> columns, we developed a list of terms that
captured the majority of instances where records had failures or
unacceptable measurements. We found the phrasing to be consistent across
columns and so we searched for the same (case agnostic) terms in all
four locations. The terms are: “beyond accept”, “cancelled”,
“contaminat”, “error”, “fail”, “improper”, “instrument down”,
“interference”, “invalid”, “no result”, “no test”, “not accept”,
“outside of accept”, “problem”, “QC EXCEEDED”, “questionable”,
“suspect”, “unable”, “violation”, “reject”, “no data”.</p>
<p>Below are pie charts that break down the number of failure detections by
column. Note that the plotting below is automated so if one or more of
the columns listed above are not plotted, this indicates that the
column(s) did not return any matches for the failure phrases. Also note
that a single record can contain multiple failure phrases; therefore,
failure phrases are not mutually exclusive.</p>
<p><br></p>
<div id="activitycommenttext-fail-detects" class="section level4 hasAnchor" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> ActivityCommentText fail detects<a href="chlorophyll-a-chla-harmonization-process.html#activitycommenttext-fail-detects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="3_harmonize/out/chla_ActivityCommentText_fail_pie.png" alt="ActivityCommentText failure detects" width="650"/></p>
</div>
<div id="resultcommenttext-fail-detects" class="section level4 hasAnchor" number="5.2.2.2">
<h4><span class="header-section-number">5.2.2.2</span> ResultCommentText fail detects<a href="chlorophyll-a-chla-harmonization-process.html#resultcommenttext-fail-detects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="3_harmonize/out/chla_ResultCommentText_fail_pie.png" alt="ResultCommentText failure detects" width="650"/></p>
</div>
<div id="resultlaboratorycommenttext-fail-detects" class="section level4 hasAnchor" number="5.2.2.3">
<h4><span class="header-section-number">5.2.2.3</span> ResultLaboratoryCommentText fail detects<a href="chlorophyll-a-chla-harmonization-process.html#resultlaboratorycommenttext-fail-detects" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="3_harmonize/out/chla_ResultLaboratoryCommentText_fail_pie.png" alt="ResultLaboratoryCommentText failure detects" width="650"/></p>
<p><br></p>
<!-- <img src="3_harmonize/out/chla_ResultCommentText_fail_pie.png" alt="ResultCommentText failure detects" width="650"/> -->
<!-- <br> -->
<p>85.83 thousand rows are removed after detecting failure-related phrases
and 4.39 million rows remain.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-12-1.png" /><!-- --></p>
<p><br></p>
</div>
</div>
<div id="clean-mdls" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Clean MDLs<a href="chlorophyll-a-chla-harmonization-process.html#clean-mdls" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this step method detection limits (MDLs) are used to clean up the
reported values. When a numeric value is missing for the data record
(i.e., <code>NA</code> or text that became <code>NA</code> during an <code>as.numeric</code> call) we
check for non-detect language in the <code>ResultLaboratoryCommentText</code>,
<code>ResultCommentText</code>, <code>ResultDetectionConditionText</code>, and
<code>ResultMeasureValue</code> columns. This language can be <code>"non-detect"</code>,
<code>"not detect"</code>, <code>"non detect"</code>, <code>"undetect"</code>, or <code>"below"</code>.</p>
<p>If non-detect language exists then we use the
<code>DetectionQuantitationLimitMeasure.MeasureValue</code> column for the MDL,
otherwise if there is a <code>&lt;</code> and a number in the <code>ResultMeasureValue</code>
column we use that number instead.</p>
<p>We then use a random number between 0 and <code>0.5 * MDL</code> as the record’s
value moving forward.</p>
<p>We produce a new column, <code>mdl_flag</code>, from the MDL cleaning process.
Records where no MDL-based adjustment was made and which are at or above
the MDL are assigned a 0. Records with corrected values based on the MDL
method are assigned a 1. Finally, records where no MDL-based adjustment
was made and which contain a numeric value below the provided MDL are
assigned a 2.</p>
<p>Most of this step should not result in a change in rows, but we do drop
records with negative measurement values. This results in 0 rows being
removed. The final row count after this is 4.39 million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-14-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-approximate-values" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Clean approximate values<a href="chlorophyll-a-chla-harmonization-process.html#clean-approximate-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cleaning approximate values involves a similar process as for MDL
cleaning. We flag “approximated” values in the dataset. The
<code>ResultMeasureValue</code> column gets checked for <strong>all</strong> three of the
following conditions:</p>
<ol style="list-style-type: decimal">
<li>Numeric-only version of the column is still <code>NA</code> after MDL cleaning</li>
<li>The original column text contained a number</li>
<li>Any of <code>ResultLaboratoryCommentText</code>, <code>ResultCommentText</code>, or
<code>ResultDetectionConditionText</code> match this regular expression,
ignoring case: <code>"result approx|RESULT IS APPROX|value approx"</code></li>
</ol>
<p>We then use the approximate value as the record’s value moving forward.</p>
<p>Records with corrected values based on the above method are noted with a
1 in the <code>approx_flag</code> column.</p>
<p>This should not result in a change in rows but we still check: 0 rows
are removed. The final row count after this is 4.39 million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-16-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-values-with-greater-than-data" class="section level3 hasAnchor" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Clean values with “greater than” data<a href="chlorophyll-a-chla-harmonization-process.html#clean-values-with-greater-than-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step is similar to the MDL and approximate value cleaning
processes, and follows the approximate cleaning process most closely.
The goal is to clean up values that were entered as “greater than” some
value. The <code>ResultMeasureValue</code> column gets checked for <strong>all</strong> three of
the following conditions:</p>
<ol style="list-style-type: decimal">
<li>Numeric-only version of the column is still <code>NA</code> after MDL &amp;
approximate cleaning</li>
<li>The original column text contained a number</li>
<li>The original column text contained a <code>&gt;</code></li>
</ol>
<p>We then use the “greater than” value (without <code>&gt;</code>) as the record’s value
moving forward.</p>
<p>Records with corrected values based on the above method are noted with a
1 in the <code>greater_flag</code> column.</p>
<p>This should not result in a change in rows but we still check: 0 rows
are removed. The final row count after this is 4.39 million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-18-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="drop-unresolved-na-measurements" class="section level3 hasAnchor" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> Drop unresolved NA measurements<a href="chlorophyll-a-chla-harmonization-process.html#drop-unresolved-na-measurements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The goal of the preceding three steps was to prevent records with
seemingly missing measurement data from being dropped if there was still
a chance of recovering a usable value. At this point we’ve finished with
that process and we proceed to check for remaining records with <code>NA</code>
values in their <code>harmonized_value</code> column. If they exist, they are
dropped. We also filter out any negative values in the dataset at this
point.</p>
<p>2.2795^{4} rows are removed. The final row count after this is 4.37
million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-20-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="harmonize-record-units" class="section level3 hasAnchor" number="5.2.7">
<h3><span class="header-section-number">5.2.7</span> Harmonize record units<a href="chlorophyll-a-chla-harmonization-process.html#harmonize-record-units" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next step in chla harmonization is converting the units of WQP
records. We create the following conversion table, which is used to
translate units provided in WQP into micrograms per liter (ug/L):</p>
<table class=" lightable-paper table" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
ResultMeasure.MeasureUnitCode
</th>
<th style="text-align:right;">
conversion
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mg/l
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/L
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
ppm
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/l
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/L
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/m3
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
ppb
</td>
<td style="text-align:right;">
1e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/cm3
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/ml
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/ml
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
<tr>
<td style="text-align:left;">
ppt
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
<tr>
<td style="text-align:left;">
ug/mL
</td>
<td style="text-align:right;">
1e+03
</td>
</tr>
<tr>
<td style="text-align:left;">
mg/mL
</td>
<td style="text-align:right;">
1e+06
</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Below is a pie chart that breaks down the different unit codes that were
dropped in the unit harmonization process, and how many records were
lost with each code.</p>
<p><br></p>
<p><img src="3_harmonize/out/chla_unit_drop_pie.png" alt="ResultMeasure.MeasureUnitCode mismatched codes" width="650"/></p>
<p><br></p>
<p>Additionally we provide a set of histograms of harmonized measurements
by <code>CharacteristicName</code>:</p>
<p><br></p>
<p><img src="3_harmonize/out/chla_charname_dists.png" alt="Distribution of chl *a* values by CharacteristicName" width="650"/></p>
<p><br></p>
<p>211.8 thousand rows are removed. The final row count after this is 4.16
million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-23-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="clean-depth-data" class="section level3 hasAnchor" number="5.2.8">
<h3><span class="header-section-number">5.2.8</span> Clean depth data<a href="chlorophyll-a-chla-harmonization-process.html#clean-depth-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next harmonization step cleans the four depth-related columns
obtained from the WQP. The details behind this step are covered in the
<em>Depth flags</em> section of the <em>Tiering, flagging, and quality control
philosophy</em> chapter.</p>
<p>This should not result in a change in rows but we still check: 0 rows
are removed. The final row count after this is 4.16 million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-25-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="filter-and-tier-methods" class="section level3 hasAnchor" number="5.2.9">
<h3><span class="header-section-number">5.2.9</span> Filter and tier methods<a href="chlorophyll-a-chla-harmonization-process.html#filter-and-tier-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We next review the analytical methods used in measuring chlorophyll <em>a</em>,
primarily by classifying the text provided with each record in
<code>ResultAnalyticalMethod.MethodName</code>. Once these methods are classified
we arrange them into hierarchical tiers as described in the <em>Method
tiering</em> section of the <em>Tiering, flagging, and quality control
philosophy</em> chapter.</p>
<p>However, prior to classification we check the
<code>ResultAnalyticalMethod.MethodName</code> column for names that indicate
non-chlorophyll <em>a</em> measurements. Phrases used to flag and remove
unrelated methods from chlorophyll <em>a</em> data are: “sulfate”, “sediment”,
“5310”, “counting”, “plasma”, “turbidity”, “coliform”, “carbon”, “2540”,
“conductance”, “nitrate”, “nitrite”, “nitrogen”, “alkalin”,
“zooplankton”, “phosphorus”, “periphyton”, “peri”, “biomass”,
“temperature”, “elemental analyzer”, “2320”.</p>
<p>This process drops 66.9 thousand rows leaving 4.09 million remaining.</p>
<p>The next step towards creating tiers is to then classify the methods in
<code>ResultAnalyticalMethod.MethodName</code> into either: HPLC methods,
spectrophotometer and fluorometer methods, or methods for which a
pheophytin correction is recorded as part of the methodology. These
classifications are not the final tiers, but they inform the tiering in
the final step of this process. The criteria for each of the above
classifications are:</p>
<ul>
<li><strong>HPLC:</strong> Detection of “447”, “chromatography”, or “hplc” in the
<code>ResultAnalyticalMethod.MethodName</code> or presence of 70951 or 70953 in
the <code>USGSPCode</code> column</li>
<li><strong>Spectro/fluoro:</strong> Detection of “445”, “fluor”, “Welshmeyer”, “fld”,
“10200”, “446”, “trichromatic”, “spectrophoto”, “monochrom”,
“monchrom”, or “spec” not as part of a word in
<code>ResultAnalyticalMethod.MethodName</code></li>
<li><strong>Pheophytin correction:</strong> Detection of “correct”, “445”, “446”, or
“in presence” in <code>ResultAnalyticalMethod.MethodName</code> or detection of
“corrected for pheophytin” or “free of pheophytin” in
<code>CharacteristicName</code></li>
</ul>
<p>Finally, we group the data into three tiers as described in <em>Tiering,
flagging, and quality control philosophy</em>. These tiers are:</p>
<p><br></p>
<!-- Table created with https://www.tablesgenerator.com/markdown_tables -->
<table>
<colgroup>
<col width="1%" />
<col width="2%" />
<col width="66%" />
<col width="28%" />
<col width="1%" />
</colgroup>
<thead>
<tr class="header">
<th>Tier</th>
<th>Name</th>
<th>Description</th>
<th>Chl <em>a</em> details</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Restrictive</td>
<td>Data that are verifiably self-similar across organizations and time-periods and can be considered highly reliable and interoperable</td>
<td>Includes records using HPLC methods</td>
<td></td>
</tr>
<tr class="even">
<td>1</td>
<td>Narrowed</td>
<td>Data that we have good reason to believe are self-similar, but for which we can’t verify full interoperability across data providers</td>
<td>Spectrophotometer and fluorometer methods that <strong>are also</strong> pheophytin-corrected <strong><em>OR</em></strong> records where <code>USGSPCode</code> is 32209</td>
<td></td>
</tr>
<tr class="odd">
<td>2</td>
<td>Inclusive</td>
<td>Data that are assumed to be reliable and are harmonized to our best ability given the information available from the data provider. This tier includes <code>NA</code> or non-resolvable descriptions for the analytical method, which often make up the majority of methods descriptions for any given parameter</td>
<td>All other records by default, including <code>NA</code> methods and <em>in situ</em> probes</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>Note</strong>: Spectrophotometer and fluorometer methods that are labeled as
pheophytin-corrected are grouped into the “Narrowed” tier. Depending on
the exact implementation of EPA method 445, the correction philosophy
may vary, and there is no agreed upon method to rectify inconsistencies
in data entry related to these methodological differences. The final
harmonization product that aggregates simultaneous records does <em>not</em>
retain the <code>CharacteristicName</code> or <code>ResultAnalyticalMethod.MethodName</code>
columns. However, the non-aggregated version of the harmonized dataset
(<code>p3_chla_preagg_grouped</code>) includes those columns. We encourage any
users that want to explicitly compare or account for pheophytin
correction to use the <code>p3_chla_preagg_grouped</code> dataset.</p>
<p><br></p>
<p>At this point we export a file
(<code>3_harmonize/out/chla_tiering_record.csv</code>) that contains a record of
how specific method text was tiered and how many row counts corresponded
to each method.</p>
<p><br></p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-27-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="flag-based-on-field-methods" class="section level3 hasAnchor" number="5.2.10">
<h3><span class="header-section-number">5.2.10</span> Flag based on field methods<a href="chlorophyll-a-chla-harmonization-process.html#flag-based-on-field-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next we flag field sampling methods based primarily on the
<code>SampleCollectionMethod.MethodName</code> column. We first classify each
record into either <em>in vitro</em> or <em>in situ</em> methods (i.e., <em>in vitro</em>
assumes a water sample was collected and taken to a lab for analysis;
<em>in situ</em> assumes a measurement was obtained in the field).</p>
<p>We used the following strings to mark <strong>in vitro</strong> samples: “grab”,
“bottle”, “vessel”, “bucket”, “jar”, “composite”, “integrate”, “UHL001”,
“surface”, “filter”, “filtrat”, “1060B”, “kemmerer”, “collect”,
“rosette”, “equal width”, “vertical”, “van dorn”, “bail”, “sample”,
“sampling”, “lab” not in the middle of another word, or a “G” on its own
as shorthand for “grab”. <strong>In situ</strong> samples were detected using “<em>in
situ</em>”, “probe”, or “ctd”.</p>
<p>Lastly we created the field flag based on whether the sampling method
used agrees with the analytical method. Flags of 0 indicated that the
field sampling method is in agreement with the analytical method, 1
indicates that the field sampling methods are uncharacteristic of the
analytical method, and anything with tier of 2 is given a field flag of
2 due to the ambiguity associated with those observations’ analytical
methods and corresponding sampling methods.</p>
<p>The following rules are used for chlorophyll a field sampling flags:</p>
<ul>
<li><strong>Flag 0</strong>: Restrictive and narrowed tiers with in vitro field methods</li>
<li><strong>Flag 1</strong>: Restrictive and narrowed tiers with in situ field methods</li>
<li><strong>Flag 2</strong>: Any entry in the inclusive tier</li>
</ul>
<p>No records should be removed by this process and so there are 0 rows
dropped leaving 4.09 million remaining in the harmonized chlorophyll <em>a</em>
dataset.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-29-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="miscellaneous-flag" class="section level3 hasAnchor" number="5.2.11">
<h3><span class="header-section-number">5.2.11</span> Miscellaneous flag<a href="chlorophyll-a-chla-harmonization-process.html#miscellaneous-flag" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next we add a placeholder for the miscellaneous flag column,
<code>misc_flag</code>.</p>
<p>Some parameters will have additional flagging requirements that
chlorophyll <em>a</em> does not, so we include this placeholder to maintain the
same columns across all parameter data products.</p>
<p>No records should be removed by this process and so there are 0 rows
dropped leaving 4.09 million remaining in the harmonized chlorophyll <em>a</em>
dataset.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-31-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="remove-unrealistic-values" class="section level3 hasAnchor" number="5.2.12">
<h3><span class="header-section-number">5.2.12</span> Remove unrealistic values<a href="chlorophyll-a-chla-harmonization-process.html#remove-unrealistic-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before finalizing the dataset we remove chlorophyll <em>a</em> values that are
beyond a realistic threshold. We use 1000 ug/L as our cutoff for removal
(Wetzel, 2001, Chapter 15, Figure 19).</p>
<p>7659 rows are removed. The final row count after this is 4.08 million.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-33-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="aggregate-simultaneous-records" class="section level3 hasAnchor" number="5.2.13">
<h3><span class="header-section-number">5.2.13</span> Aggregate simultaneous records<a href="chlorophyll-a-chla-harmonization-process.html#aggregate-simultaneous-records" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final step of chlorophyll <em>a</em> harmonization is to aggregate
simultaneous observations. Any group of samples determined to be
simultaneous are simplified into a single record containing the mean and
coefficient of variation (CV) of the group. These can be either true
duplicate entries in the WQP or records with non-identical values
recorded at the same time and place and by the same organization (field
and/or lab replicates/duplicates). The CV can be used to filter the
dataset based on the amount of variability that is tolerable to specific
use cases. Note, however, that many entries will have a CV that is <code>NA</code>
because there are no duplicates or 0 because the records are duplicates
and all entries have the same <code>harmonized_value</code>.</p>
<p>We identify simultaneous records to aggregate by creating identical
subgroups (<code>subgroup_id</code>) from the following columns: <code>parameter</code>,
<code>OrganizationIdentifier</code>, <code>MonitoringLocationIdentifier</code>,
<code>MonitoringLocationTypeName</code>, <code>ResolvedMonitoringLocationTypeName</code>,
<code>ActivityStartDate</code>, <code>ActivityStartDateTime</code>,
<code>ActivityStartTime.TimeZoneCode</code>, <code>harmonized_tz</code>, <code>harmonized_utc</code>,
<code>harmonized_top_depth_value</code>, <code>harmonized_top_depth_unit</code>,
<code>harmonized_bottom_depth_value</code>, <code>harmonized_bottom_depth_unit</code>,
<code>harmonized_discrete_depth_value</code>, <code>harmonized_discrete_depth_unit</code>,
<code>depth_flag</code>, <code>mdl_flag</code>, <code>approx_flag</code>, <code>greater_flag</code>, <code>tier</code>,
<code>field_flag</code>, <code>misc_flag</code>, <code>harmonized_units.</code> This selection limits the
columns included in the final dataset, but we also provide a copy of the
AquaMatch dataset prior to its aggregation (pipeline target
<code>p3_chla_preagg_grouped</code>), and including the <code>subgroup_id</code> column, so
that users can use the non-aggregated data as well and match make joins
between dataset versions.</p>
<p>The final, aggregated values are presented in the <code>harmonized_value</code> and
<code>harmonized_value_cv</code> columns. The number of rows used per group is
recorded in the <code>harmonized_row_count</code> column.</p>
<p>0 rows dropped leaving 4.09 million remaining in the final harmonized
and aggregated chlorophyll <em>a</em> dataset.</p>
<p><img src="chapters/04_chla_harmonization_files/figure-gfm/unnamed-chunk-35-1.png" /><!-- --></p>
<p><br></p>
</div>
<div id="harmonized-chlorophyll-a" class="section level3 hasAnchor" number="5.2.14">
<h3><span class="header-section-number">5.2.14</span> Harmonized chlorophyll a<a href="chlorophyll-a-chla-harmonization-process.html#harmonized-chlorophyll-a" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At this point the harmonization of the chlorophyll <em>a</em> data from the WQP
is complete and we export the final dataset for use later in the
workflow.</p>
<p>Below is a final set of histograms showing the distribution of
harmonized measurements (top) and CVs (bottom) broken down by <code>tier</code>
<strong><em>after</em></strong> aggregating simultaneous records.</p>
<p><br></p>
<p><img src="3_harmonize/out/chla_tier_dists_postagg.png" alt="Distribution of chl *a* values by tier" width="650"/></p>
<p><img src="3_harmonize/out/chla_tier_cv_dists_postagg.png" alt="Distribution of chl *a* CVs by tier" width="650"/></p>
<p><br></p>

<!-- Image settings -->
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tiering-flagging-and-quality-control-philosophy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="doc-harmonization-process.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
